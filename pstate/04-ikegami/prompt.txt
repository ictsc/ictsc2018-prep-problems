「Tunnel」

この問題はステップが2つに分かれています。
これらのステップを別々にメールで送信しても構いません。
その場合、メールの本文に「どちらのステップについての回答・質問か」を明記していただきますようよろしくお願いいたします。

まずは以下のURLからトポロジーをダウンロードできるので、こちらをご覧ください。
https://drive.google.com/open?id=1uVoNZJoAUj8DPcAnjBTeo40v1R2QOoxT

この問題の世界では172.20.0.0/16はインターネットで使われるアドレスで、ISPから割り当てられるものとします。
みなさんはとある企業の大阪支部にいます。この大阪支部はISPから172.20.1.1が割り当てられています。
大阪支部ではそのアドレスをGatewayであるルーター`osaka`でNATし、社内で使用しています。
東京には本部があります。こちらはISPから172.20.2.1がosakaと同じように割り当てられており、同じくGatewayのルーター`tokyo`でNATして社内で使用しています。
PC`fumidai`は大阪支部に設置されたPCです。
このPCにはもう一つIPアドレス`192.168.10.1`が割り当てられおり、デフォルトルートはルーターosakaの192.168.10.254へ向けられています。
PINGなどもここから打つことができます。

#### アクセス情報
VNCサーバーにSSHしたら、そこからPC`fumidai`にSSHしてください。IPアドレス:`192.168.0.10`ID:`admin`,PASS:`password`
まず疎通確認として、CloudflareのPublicDNS`1.1.1.1`にtracerouteしてみましょう。以下のようになっていればOKです。

```
[admin@fumidai:~]%traceroute 1.1.1.1

traceroute to 1.1.1.1 (1.1.1.1), 30 hops max, 60 byte packets
 1  gateway (192.168.10.254)  1.220 ms  1.138 ms  1.110 ms
 2  172.20.1.254 (172.20.1.254)  1.299 ms  1.290 ms  1.298 ms
  ...
```

次に皆さんが操作するネットワーク機器にアクセスしてもらいましょう
fumidaiからルーター`osaka(192.168.10.254)`にSSHしてください。ID:`gre`,PASS:`tunnel`,enablePASS`tunnel`
それでは問題に移っていきましょう


### STEP1. GREトンネルを張ってもらいましょう
現時点では、大阪支部と東京本部では別々にNATしているため、大阪支部から東京にあるサーバーにアクセスすることはできません。
これを解決するためには、各Gatewayで拠点間VPNを張る必要があります。(上図紫の部分)
正しく設定をすると、PC`fumidai`から東京本部のサーバー`192.168.20.1`に以下のような形でtracerouteすることができます。

```
[admin@fumidai:~]%traceroute 192.168.20.1

traceroute to 192.168.20.1 (192.168.20.1), 30 hops max, 60 byte packets
 1  gateway (192.168.10.254)  1.766 ms  1.706 ms  1.706 ms
 2  192.168.100.2 (192.168.100.2)  2.638 ms  2.633 ms  2.640 ms
 3  192.168.20.1 (192.168.20.1)  2.875 ms  2.845 ms  2.793 ms
[admin@fumidai:~]%
```

今回は、拠点間VPNの一つである`GRE Tunnel`をルーターosaka側に設定してください。


### STEP2. デフォルトルートをトンネルに切り替えましょう
GRE Tunnelの設定ができましたら、もう一度CloudflareのPublicDNS`1.1.1.1`にtracerouteしてみましょう。
```
[admin@fumidai:~]%traceroute 1.1.1.1
traceroute to 1.1.1.1 (1.1.1.1), 30 hops max, 60 byte packets
 1  gateway (192.168.10.254)  1.092 ms  1.063 ms  1.060 ms
 2  172.20.1.254 (172.20.1.254)  1.168 ms  1.145 ms  1.120 ms
以下省略
```

先ほどと何も変わってないはずです。
そこで次は、大阪支部から外部へのパケットがすべて東京本部を経由するようにルーター`osaka`に設定してください。
正しく設定ができていると、PC`fumidai`からCloudflareのPublicDNS`1.1.1.1`にtracerouteしたときに以下のように経路が変わっているはずです。
```
[admin@fumidai:~]%traceroute 1.1.1.1
traceroute to 1.1.1.1 (1.1.1.1), 30 hops max, 60 byte packets
 1  gateway (192.168.10.254)  0.753 ms  0.722 ms  0.704 ms
 2  192.168.100.2 (192.168.100.2)  0.891 ms  0.875 ms  0.817 ms
 3  172.20.2.254 (172.20.2.254)  1.389 ms  1.365 ms  1.338 ms
以下省略```


ルーター・サーバーへのアクセス情報
  踏み台VNCサーバから以下のサーバにアクセスすることができます。
  1. fumidai (画面を見るためのVNCサーバーではない踏み台サーバー）
    Address: 192.168.0.10
    User: admin
    Password: password

  以下のルーターは踏み台VNCサーバーから直接アクセスすることができません。
  2. osaka (大阪側ルーター）
    Address: 192.168.10.254 (1. fumidaiサーバーからSSH接続することができます）
    User: gre
    Password: tunnel
    Enable password: tunnel


ゴール (STEP1)
  拠点間VPNの一つである`GRE Tunnel`をルーターosaka側に設定する

ゴール（STEP2）
  大阪支部から外部へのパケットがすべて東京本部を経由するようにルーター`osaka`に設定する



完了した際には、yosen@icttoracon.net 宛に以下の内容で完了報告のメールを送信してください。

—
件名: [ICTSC2018-予選1][問4-P1][TEAM（チーム番号）][ANSWER] Tunnel
本文: 内容は基本自由ですが、記録(どのようなコマンドで作業を行ったか等)を必ず記入してください。
—


また、質問がある場合はyosen@icttoracon.net 宛に以下の内容で質問のメールを送信してください。

—
件名: [ICTSC2018-予選1][問4-P1][TEAM（チーム番号）][QUESTION] Tunnel
本文: 質問内容を記載してください。
―

